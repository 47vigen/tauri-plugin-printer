import{Buffer as e}from"buffer";function t(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))}function n(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}}async function r(e,t={},n){return window.__TAURI_INTERNALS__.invoke(e,t,n)}"function"==typeof SuppressedError&&SuppressedError,"function"==typeof SuppressedError&&SuppressedError;var i={512:{name:"Completed",description:"An error condition, possibly on a print job that precedes this one in the queue, blocked the print job."},4096:{name:"Completed",description:"The print job is complete, including any post-printing processing."},256:{name:"Deleted",description:"The print job was deleted from the queue, typically after printing."},4:{name:"Deleting",description:"The print job is in the process of being deleted."},2:{name:"Error",description:"The print job is in an error state."},0:{name:"None",description:"The print job has no specified state."},32:{name:"Offline",description:"The printer is offline."},64:{name:"PaperOut",description:"The printer is out of the required paper size."},1:{name:"Paused",description:"The print job is paused."},128:{name:"Printed",description:"The print job printed."},16:{name:"Printing",description:"The print job is now printing."},2048:{name:"Restarted",description:"The print job was blocked but has restarted."},8192:{name:"Retained",description:"The print job is retained in the print queue after printing."},1024:{name:"UserIntervention",description:"The printer requires user action to fix an error condition."},8:{name:"Spooling",description:"The print job is spooling."}},o=function(e,t){void 0===t&&(t=[]);try{return JSON.parse(e)}catch(e){return t}},a=function(t){return"undefined"==typeof window?e.from(t,"utf-8").toString("base64"):window.btoa(t)},s=function(t){return"undefined"==typeof window?e.from(t,"base64").toString("utf-8"):window.atob(t)},u=function(e){return void 0===e&&(e=null),t(void 0,void 0,void 0,(function(){var t,i,u,l,p,c,d;return n(this,(function(n){switch(n.label){case 0:return null==e?[3,2]:[4,r("plugin:printer|get_printers_by_name",{printername:s(e)})];case 1:return t=n.sent(),null==(c=o(t,null))?[2,[]]:[2,[{id:e,name:c.Name,driver_name:c.DriverName,job_count:c.JobCount,print_processor:c.PrintProcessor,port_name:c.PortName,share_name:c.ShareName,computer_name:c.ComputerName,printer_status:c.PrinterStatus,shared:c.Shared,type:c.Type,priority:c.Priority}]];case 2:return[4,r("plugin:printer|get_printers")];case 3:for(i=n.sent(),u=o(i),l=[],p=0;p<u.length;p++)c=u[p],d=a(c.Name),l.push({id:d,name:c.Name,driver_name:c.DriverName,job_count:c.JobCount,print_processor:c.PrintProcessor,port_name:c.PortName,share_name:c.ShareName,computer_name:c.ComputerName,printer_status:c.PrinterStatus,shared:c.Shared,type:c.Type,priority:c.Priority});return[2,l]}}))}))},l=function(i){return t(void 0,void 0,void 0,(function(){var t,o,a,u,l,p,c,d,m,b,g,f,h;return n(this,(function(n){switch(n.label){case 0:if(null==i.id&&null==i.name)throw new Error("print_file require id | name as string");if(null==i.path&&null==i.file)throw new Error("print_file require parameter path as string | file as Buffer");if(t="",t=void 0!==i.id?s(i.id):i.name,o={paper:"A4",method:"simplex",scale:"noscale",orientation:"portrait",repeat:1},void 0!==(null===(d=null==i?void 0:i.print_setting)||void 0===d?void 0:d.paper)&&(o.paper=i.print_setting.paper),void 0!==(null===(m=null==i?void 0:i.print_setting)||void 0===m?void 0:m.method)&&(o.method=i.print_setting.method),void 0!==(null===(b=null==i?void 0:i.print_setting)||void 0===b?void 0:b.scale)&&(o.scale=i.print_setting.scale),void 0!==(null===(g=null==i?void 0:i.print_setting)||void 0===g?void 0:g.orientation)&&(o.orientation=i.print_setting.orientation),void 0!==(null===(f=null==i?void 0:i.print_setting)||void 0===f?void 0:f.repeat)&&(o.repeat=i.print_setting.repeat),void 0!==(null===(h=null==i?void 0:i.print_setting)||void 0===h?void 0:h.range)&&(o.range=i.print_setting.range),void 0!==i.path){if(i.path.split(".").length<=1)throw new Error("File not supported");if("pdf"!=i.path.split(".").pop())throw new Error("File not supported")}if(a="",o.range)if("string"==typeof o.range){if(!new RegExp(/^[0-9,]+$/).test(o.range))throw new Error("Invalid range value ");a=","!=o.range[o.range.length-1]?o.range:o.range.substring(0,o.range.length-1)}else o.range.from&&(a="".concat(o.range.from,"-").concat(o.range.to));if(u="-print-settings ".concat(a,",").concat(o.paper,",").concat(o.method,",").concat(o.scale,",").concat(o.orientation,",").concat(o.repeat,"x"),l="",void 0===i.file)return[3,2];if("25504446"!=i.file.subarray(0,4).toString("hex"))throw new Error("File not supported");if(0==e.isBuffer(i.file))throw new Error("Invalid buffer");return p="".concat(Math.floor(1e8*Math.random()),"_").concat(Date.now(),".pdf"),[4,r("plugin:printer|create_temp_file",{buffer_data:i.file.toString("base64"),filename:p})];case 1:if(0==(l=n.sent()).length)throw new Error("Fail to create temp file");n.label=2;case 2:return c={id:'"'.concat(t,'"'),path:i.path,printer_setting:u,remove_after_print:!i.remove_temp||i.remove_temp},void 0!==i.file&&(c.path=l),[4,r("plugin:printer|print_pdf",c)];case 3:return n.sent(),[2,{success:!0,message:"OK"}]}}))}))},p=function(e){return void 0===e&&(e=null),t(void 0,void 0,void 0,(function(){var t,s,l,p,c,d,m,b,g,f,h,v,_,w,j,S,y,P;return n(this,(function(n){switch(n.label){case 0:return t=[],null==e?[3,3]:[4,u(e)];case 1:return 0==(b=n.sent()).length?[2,[]]:[4,r("plugin:printer|get_jobs",{printername:b[0].name})];case 2:for(g=n.sent(),null==(f=o(g,[])).length&&(f=[f]),s=0,l=f;s<l.length;s++)p=l[s],w=a("".concat(b[0].name,"_@_").concat(p.Id)),t.push({id:w,job_id:p.Id,job_status:null!=i[p.JobStatus]?{code:p.JobStatus,description:i[p.JobStatus].description,name:i[p.JobStatus].name}:{code:p.JobStatus,description:"Unknown Job Status",name:"Unknown"},computer_name:p.ComputerName,data_type:p.Datatype,document_name:p.DocumentName,job_time:p.JobTime,pages_printed:p.PagesPrinted,position:p.Position,printer_name:p.PrinterName,priority:p.Priority,size:p.Size,submitted_time:p.SubmittedTime?+(null===(S=null===(j=p.SubmittedTime)||void 0===j?void 0:j.replace("/Date(",""))||void 0===S?void 0:S.replace(")/","")):null,total_pages:p.TotalPages,username:p.UserName});return[2,t];case 3:return[4,u()];case 4:c=n.sent(),d=0,m=c,n.label=5;case 5:return d<m.length?[4,r("plugin:printer|get_jobs",{printername:(b=m[d]).name})]:[3,8];case 6:for(g=n.sent(),null==(f=o(g,[])).length&&(f=[f]),h=0,v=f;h<v.length;h++)_=v[h],w=a("".concat(b.name,"_@_").concat(_.Id)),t.push({id:w,job_id:_.Id,job_status:null!=i[_.JobStatus]?{code:_.JobStatus,description:i[_.JobStatus].description,name:i[_.JobStatus].name}:{code:_.JobStatus,description:"Unknown Job Status",name:"Unknown"},computer_name:_.ComputerName,data_type:_.Datatype,document_name:_.DocumentName,job_time:_.JobTime,pages_printed:_.PagesPrinted,position:_.Position,printer_name:_.PrinterName,priority:_.Priority,size:_.Size,submitted_time:_.SubmittedTime?+(null===(P=null===(y=_.SubmittedTime)||void 0===y?void 0:y.replace("/Date(",""))||void 0===P?void 0:P.replace(")/","")):null,total_pages:_.TotalPages,username:_.UserName});n.label=7;case 7:return d++,[3,5];case 8:return[2,t]}}))}))},c=function(e){return t(void 0,void 0,void 0,(function(){var t,a,u,l,p,c,d,m,b;return n(this,(function(n){switch(n.label){case 0:return t=s(e),a=t.split("_@_"),u=a[0],l=void 0===u?null:u,p=a[1],[4,r("plugin:printer|get_jobs_by_id",{printername:l,jobid:void 0===p?null:p})];case 1:return c=n.sent(),d=o(c,null),[2,{id:e,job_id:d.Id,job_status:null!=i[d.JobStatus]?{code:d.JobStatus,description:i[d.JobStatus].description,name:i[d.JobStatus].name}:{code:d.JobStatus,description:"Unknown Job Status",name:"Unknown"},computer_name:d.ComputerName,data_type:d.Datatype,document_name:d.DocumentName,job_time:d.JobTime,pages_printed:d.PagesPrinted,position:d.Position,printer_name:d.PrinterName,priority:d.Priority,size:d.Size,submitted_time:d.SubmittedTime?+(null===(b=null===(m=d.SubmittedTime)||void 0===m?void 0:m.replace("/Date(",""))||void 0===b?void 0:b.replace(")/","")):null,total_pages:d.TotalPages,username:d.UserName}]}}))}))},d=function(e){return void 0===e&&(e=null),t(void 0,void 0,void 0,(function(){var t,i,a,l,p,c,d,m,b,g,f,h,v,_,w,j,S;return n(this,(function(n){switch(n.label){case 0:if(n.trys.push([0,11,,12]),t={success:!0,message:"OK"},null==e)return[3,2];if(i=s(e),a=i.split("_@_"),l=a[0],p=void 0===l?null:l,c=a[1],d=void 0===c?null:c,null==p||null==d)throw new Error("Wrong jobid");return[4,r("plugin:printer|restart_job",{printername:p,jobid:d.toString()})];case 1:return n.sent(),[2,t];case 2:return[4,u()];case 3:m=n.sent(),b=0,g=m,n.label=4;case 4:return b<g.length?[4,r("plugin:printer|get_jobs",{printername:(f=g[b]).name})]:[3,10];case 5:h=n.sent(),v=o(h,[]),_=0,w=v,n.label=6;case 6:return _<w.length?(j=w[_],[4,r("plugin:printer|restart_job",{printername:f.name,jobid:j.Id.toString()})]):[3,9];case 7:n.sent(),n.label=8;case 8:return _++,[3,6];case 9:return b++,[3,4];case 10:return[2,t];case 11:return[2,{success:!1,message:(S=n.sent()).message?S.message:"Fail to restart job"}];case 12:return[2]}}))}))},m=function(e){return void 0===e&&(e=null),t(void 0,void 0,void 0,(function(){var t,i,a,l,p,c,d,m,b,g,f,h,v,_,w,j,S;return n(this,(function(n){switch(n.label){case 0:if(n.trys.push([0,11,,12]),t={success:!0,message:"OK"},null==e)return[3,2];if(i=s(e),a=i.split("_@_"),l=a[0],p=void 0===l?null:l,c=a[1],d=void 0===c?null:c,null==p||null==d)throw new Error("Wrong jobid");return[4,r("plugin:printer|resume_job",{printername:p,jobid:d.toString()})];case 1:return n.sent(),[2,t];case 2:return[4,u()];case 3:m=n.sent(),b=0,g=m,n.label=4;case 4:return b<g.length?[4,r("plugin:printer|get_jobs",{printername:(f=g[b]).name})]:[3,10];case 5:h=n.sent(),v=o(h),_=0,w=v,n.label=6;case 6:return _<w.length?(j=w[_],[4,r("plugin:printer|resume_job",{printername:f.name,jobid:j.Id.toString()})]):[3,9];case 7:n.sent(),n.label=8;case 8:return _++,[3,6];case 9:return b++,[3,4];case 10:return[2,t];case 11:return[2,{success:!1,message:(S=n.sent()).message?S.message:"Fail to resume job"}];case 12:return[2]}}))}))},b=function(e){return void 0===e&&(e=null),t(void 0,void 0,void 0,(function(){var t,i,a,l,p,c,d,m,b,g,f,h,v,_,w,j,S;return n(this,(function(n){switch(n.label){case 0:if(n.trys.push([0,11,,12]),t={success:!0,message:"OK"},null==e)return[3,2];if(i=s(e),a=i.split("_@_"),l=a[0],p=void 0===l?null:l,c=a[1],d=void 0===c?null:c,null==p||null==d)throw new Error("Wrong jobid");return[4,r("plugin:printer|pause_job",{printername:p,jobid:d.toString()})];case 1:return n.sent(),[2,t];case 2:return[4,u()];case 3:m=n.sent(),b=0,g=m,n.label=4;case 4:return b<g.length?[4,r("plugin:printer|get_jobs",{printername:(f=g[b]).name})]:[3,10];case 5:h=n.sent(),v=o(h),_=0,w=v,n.label=6;case 6:return _<w.length?(j=w[_],[4,r("plugin:printer|pause_job",{printername:f.name,jobid:j.Id.toString()})]):[3,9];case 7:n.sent(),n.label=8;case 8:return _++,[3,6];case 9:return b++,[3,4];case 10:return[2,t];case 11:return[2,{success:!1,message:(S=n.sent()).message?S.message:"Fail to pause job"}];case 12:return[2]}}))}))},g=function(e){return void 0===e&&(e=null),t(void 0,void 0,void 0,(function(){var t,i,a,l,p,c,d,m,b,g,f,h,v,_,w,j,S;return n(this,(function(n){switch(n.label){case 0:if(n.trys.push([0,11,,12]),t={success:!0,message:"OK"},null==e)return[3,2];if(i=s(e),a=i.split("_@_"),l=a[0],p=void 0===l?null:l,c=a[1],d=void 0===c?null:c,null==p||null==d)throw new Error("Wrong jobid");return[4,r("plugin:printer|remove_job",{printername:p,jobid:d.toString()})];case 1:return n.sent(),[2,t];case 2:return[4,u()];case 3:m=n.sent(),b=0,g=m,n.label=4;case 4:return b<g.length?[4,r("plugin:printer|get_jobs",{printername:(f=g[b]).name})]:[3,10];case 5:h=n.sent(),v=o(h),_=0,w=v,n.label=6;case 6:return _<w.length?(j=w[_],[4,r("plugin:printer|remove_job",{printername:f.name,jobid:j.Id.toString()})]):[3,9];case 7:n.sent(),n.label=8;case 8:return _++,[3,6];case 9:return b++,[3,4];case 10:return[2,t];case 11:return[2,{success:!1,message:(S=n.sent()).message?S.message:"Fail to pause job"}];case 12:return[2]}}))}))};export{c as job,p as jobs,b as pause_job,l as print_file,u as printers,g as remove_job,d as restart_job,m as resume_job};
