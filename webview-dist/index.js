import{Buffer as e}from"buffer";import{webcrypto as t}from"node:crypto";function n(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))}function r(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}}async function i(e,t={},n){return window.__TAURI_INTERNALS__.invoke(e,t,n)}"function"==typeof SuppressedError&&SuppressedError,"function"==typeof SuppressedError&&SuppressedError;var o={512:{name:"Completed",description:"An error condition, possibly on a print job that precedes this one in the queue, blocked the print job."},4096:{name:"Completed",description:"The print job is complete, including any post-printing processing."},256:{name:"Deleted",description:"The print job was deleted from the queue, typically after printing."},4:{name:"Deleting",description:"The print job is in the process of being deleted."},2:{name:"Error",description:"The print job is in an error state."},0:{name:"None",description:"The print job has no specified state."},32:{name:"Offline",description:"The printer is offline."},64:{name:"PaperOut",description:"The printer is out of the required paper size."},1:{name:"Paused",description:"The print job is paused."},128:{name:"Printed",description:"The print job printed."},16:{name:"Printing",description:"The print job is now printing."},2048:{name:"Restarted",description:"The print job was blocked but has restarted."},8192:{name:"Retained",description:"The print job is retained in the print queue after printing."},1024:{name:"UserIntervention",description:"The printer requires user action to fix an error condition."},8:{name:"Spooling",description:"The print job is spooling."}};const a=128;let s,u;function l(e=21){var n;n=e-=0,!s||s.length<n?(s=Buffer.allocUnsafe(n*a),t.getRandomValues(s),u=0):u+n>s.length&&(t.getRandomValues(s),u=0),u+=n;let r="";for(let t=u-e;t<u;t++)r+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&s[t]];return r}var p=function(e,t){void 0===t&&(t=[]);try{return JSON.parse(e)}catch(e){return t}},c=function(t){return"undefined"==typeof window?e.from(t,"utf-8").toString("base64"):window.btoa(t)},d=function(t){return"undefined"==typeof window?e.from(t,"base64").toString("utf-8"):window.atob(t)},m=function(e){return void 0===e&&(e=null),n(void 0,void 0,void 0,(function(){var t,n,o,a,s,u,l;return r(this,(function(r){switch(r.label){case 0:return null==e?[3,2]:[4,i("plugin:printer|get_printers_by_name",{printername:d(e)})];case 1:return t=r.sent(),null==(u=p(t,null))?[2,[]]:[2,[{id:e,name:u.Name,driver_name:u.DriverName,job_count:u.JobCount,print_processor:u.PrintProcessor,port_name:u.PortName,share_name:u.ShareName,computer_name:u.ComputerName,printer_status:u.PrinterStatus,shared:u.Shared,type:u.Type,priority:u.Priority}]];case 2:return[4,i("plugin:printer|get_printers")];case 3:for(n=r.sent(),o=p(n),a=[],s=0;s<o.length;s++)u=o[s],l=c(u.Name),a.push({id:l,name:u.Name,driver_name:u.DriverName,job_count:u.JobCount,print_processor:u.PrintProcessor,port_name:u.PortName,share_name:u.ShareName,computer_name:u.ComputerName,printer_status:u.PrinterStatus,shared:u.Shared,type:u.Type,priority:u.Priority});return[2,a]}}))}))},g=function(t){return n(void 0,void 0,void 0,(function(){var n,o,a,s,u,p,c,m,g,b,f,h,v,_;return r(this,(function(r){switch(r.label){case 0:if(!t.id&&!t.name)throw new Error("print_file require id | name as string");if(!t.path&&!t.file)throw new Error("print_file require parameter path as string | file as Buffer");if(n="",n=void 0!==t.id?d(t.id):t.name,o={paper:"A4",method:"simplex",scale:"noscale",orientation:"portrait",repeat:1},void 0!==(null===(g=null==t?void 0:t.print_setting)||void 0===g?void 0:g.paper)&&(o.paper=t.print_setting.paper),void 0!==(null===(b=null==t?void 0:t.print_setting)||void 0===b?void 0:b.method)&&(o.method=t.print_setting.method),void 0!==(null===(f=null==t?void 0:t.print_setting)||void 0===f?void 0:f.scale)&&(o.scale=t.print_setting.scale),void 0!==(null===(h=null==t?void 0:t.print_setting)||void 0===h?void 0:h.orientation)&&(o.orientation=t.print_setting.orientation),void 0!==(null===(v=null==t?void 0:t.print_setting)||void 0===v?void 0:v.repeat)&&(o.repeat=t.print_setting.repeat),void 0!==(null===(_=null==t?void 0:t.print_setting)||void 0===_?void 0:_.range)&&(o.range=t.print_setting.range),void 0!==t.path){if(t.path.split(".").length<=1)throw new Error("File not supported");if("pdf"!=t.path.split(".").pop())throw new Error("File not supported")}if(a="",o.range)if("string"==typeof o.range){if(!new RegExp(/^[0-9,]+$/).test(o.range))throw new Error("Invalid range value ");a=","!=o.range[o.range.length-1]?o.range:o.range.substring(0,o.range.length-1)}else o.range.from&&(a="".concat(o.range.from,"-").concat(o.range.to));if(s="-print-settings ".concat(a,",").concat(o.paper,",").concat(o.method,",").concat(o.scale,",").concat(o.orientation,",").concat(o.repeat,"x"),u="",!t.file)return[3,2];if(p=t.file instanceof e?t.file:e.from(t.file),"25504446"!=p.subarray(0,4).toString("hex"))throw new Error("File not supported");return c="".concat(l(),".pdf"),[4,i("plugin:printer|create_temp_file",{bufferData:p.toString("base64"),filename:c})];case 1:if(!(u=r.sent()))throw new Error("Fail to create temp file");r.label=2;case 2:return m={id:'"'.concat(n,'"'),path:t.path,printerSetting:s,removeAfterPrint:!t.remove_temp||t.remove_temp},t.file&&(m.path=u),[4,i("plugin:printer|print_pdf",m)];case 3:return r.sent(),[2,{success:!0,message:"OK"}]}}))}))},b=function(e){return void 0===e&&(e=null),n(void 0,void 0,void 0,(function(){var t,n,a,s,u,l,d,g,b,f,h,v,_,w,j,S,y;return r(this,(function(r){switch(r.label){case 0:return t=[],null==e?[3,3]:[4,m(e)];case 1:return 0==(d=r.sent()).length?[2,[]]:[4,i("plugin:printer|get_jobs",{printername:d[0].name})];case 2:for(g=r.sent(),null==(b=p(g,[])).length&&(b=[b]),n=0,a=b;n<a.length;n++)v=a[n],_=c("".concat(d[0].name,"_@_").concat(v.Id)),t.push({id:_,job_id:v.Id,job_status:null!=o[v.JobStatus]?{code:v.JobStatus,description:o[v.JobStatus].description,name:o[v.JobStatus].name}:{code:v.JobStatus,description:"Unknown Job Status",name:"Unknown"},computer_name:v.ComputerName,data_type:v.Datatype,document_name:v.DocumentName,job_time:v.JobTime,pages_printed:v.PagesPrinted,position:v.Position,printer_name:v.PrinterName,priority:v.Priority,size:v.Size,submitted_time:v.SubmittedTime?+(null===(j=null===(w=v.SubmittedTime)||void 0===w?void 0:w.replace("/Date(",""))||void 0===j?void 0:j.replace(")/","")):null,total_pages:v.TotalPages,username:v.UserName});return[2,t];case 3:return[4,m()];case 4:s=r.sent(),u=0,l=s,r.label=5;case 5:return u<l.length?[4,i("plugin:printer|get_jobs",{printername:(d=l[u]).name})]:[3,8];case 6:for(g=r.sent(),null==(b=p(g,[])).length&&(b=[b]),f=0,h=b;f<h.length;f++)v=h[f],_=c("".concat(d.name,"_@_").concat(v.Id)),t.push({id:_,job_id:v.Id,job_status:null!=o[v.JobStatus]?{code:v.JobStatus,description:o[v.JobStatus].description,name:o[v.JobStatus].name}:{code:v.JobStatus,description:"Unknown Job Status",name:"Unknown"},computer_name:v.ComputerName,data_type:v.Datatype,document_name:v.DocumentName,job_time:v.JobTime,pages_printed:v.PagesPrinted,position:v.Position,printer_name:v.PrinterName,priority:v.Priority,size:v.Size,submitted_time:v.SubmittedTime?+(null===(y=null===(S=v.SubmittedTime)||void 0===S?void 0:S.replace("/Date(",""))||void 0===y?void 0:y.replace(")/","")):null,total_pages:v.TotalPages,username:v.UserName});r.label=7;case 7:return u++,[3,5];case 8:return[2,t]}}))}))},f=function(e){return n(void 0,void 0,void 0,(function(){var t,n,a,s,u,l,c,m,g;return r(this,(function(r){switch(r.label){case 0:return t=d(e),n=t.split("_@_"),a=n[0],s=void 0===a?null:a,u=n[1],[4,i("plugin:printer|get_jobs_by_id",{printername:s,jobid:void 0===u?null:u})];case 1:return l=r.sent(),c=p(l,null),[2,{id:e,job_id:c.Id,job_status:null!=o[c.JobStatus]?{code:c.JobStatus,description:o[c.JobStatus].description,name:o[c.JobStatus].name}:{code:c.JobStatus,description:"Unknown Job Status",name:"Unknown"},computer_name:c.ComputerName,data_type:c.Datatype,document_name:c.DocumentName,job_time:c.JobTime,pages_printed:c.PagesPrinted,position:c.Position,printer_name:c.PrinterName,priority:c.Priority,size:c.Size,submitted_time:c.SubmittedTime?+(null===(g=null===(m=c.SubmittedTime)||void 0===m?void 0:m.replace("/Date(",""))||void 0===g?void 0:g.replace(")/","")):null,total_pages:c.TotalPages,username:c.UserName}]}}))}))},h=function(e){return void 0===e&&(e=null),n(void 0,void 0,void 0,(function(){var t,n,o,a,s,u,l,c,g,b,f,h,v,_,w,j,S;return r(this,(function(r){switch(r.label){case 0:if(r.trys.push([0,11,,12]),t={success:!0,message:"OK"},null==e)return[3,2];if(n=d(e),o=n.split("_@_"),a=o[0],s=void 0===a?null:a,u=o[1],l=void 0===u?null:u,null==s||null==l)throw new Error("Wrong jobid");return[4,i("plugin:printer|restart_job",{printername:s,jobid:l.toString()})];case 1:return r.sent(),[2,t];case 2:return[4,m()];case 3:c=r.sent(),g=0,b=c,r.label=4;case 4:return g<b.length?[4,i("plugin:printer|get_jobs",{printername:(f=b[g]).name})]:[3,10];case 5:h=r.sent(),v=p(h,[]),_=0,w=v,r.label=6;case 6:return _<w.length?(j=w[_],[4,i("plugin:printer|restart_job",{printername:f.name,jobid:j.Id.toString()})]):[3,9];case 7:r.sent(),r.label=8;case 8:return _++,[3,6];case 9:return g++,[3,4];case 10:return[2,t];case 11:return[2,{success:!1,message:(S=r.sent()).message?S.message:"Fail to restart job"}];case 12:return[2]}}))}))},v=function(e){return void 0===e&&(e=null),n(void 0,void 0,void 0,(function(){var t,n,o,a,s,u,l,c,g,b,f,h,v,_,w,j,S;return r(this,(function(r){switch(r.label){case 0:if(r.trys.push([0,11,,12]),t={success:!0,message:"OK"},null==e)return[3,2];if(n=d(e),o=n.split("_@_"),a=o[0],s=void 0===a?null:a,u=o[1],l=void 0===u?null:u,null==s||null==l)throw new Error("Wrong jobid");return[4,i("plugin:printer|resume_job",{printername:s,jobid:l.toString()})];case 1:return r.sent(),[2,t];case 2:return[4,m()];case 3:c=r.sent(),g=0,b=c,r.label=4;case 4:return g<b.length?[4,i("plugin:printer|get_jobs",{printername:(f=b[g]).name})]:[3,10];case 5:h=r.sent(),v=p(h),_=0,w=v,r.label=6;case 6:return _<w.length?(j=w[_],[4,i("plugin:printer|resume_job",{printername:f.name,jobid:j.Id.toString()})]):[3,9];case 7:r.sent(),r.label=8;case 8:return _++,[3,6];case 9:return g++,[3,4];case 10:return[2,t];case 11:return[2,{success:!1,message:(S=r.sent()).message?S.message:"Fail to resume job"}];case 12:return[2]}}))}))},_=function(e){return void 0===e&&(e=null),n(void 0,void 0,void 0,(function(){var t,n,o,a,s,u,l,c,g,b,f,h,v,_,w,j,S;return r(this,(function(r){switch(r.label){case 0:if(r.trys.push([0,11,,12]),t={success:!0,message:"OK"},null==e)return[3,2];if(n=d(e),o=n.split("_@_"),a=o[0],s=void 0===a?null:a,u=o[1],l=void 0===u?null:u,null==s||null==l)throw new Error("Wrong jobid");return[4,i("plugin:printer|pause_job",{printername:s,jobid:l.toString()})];case 1:return r.sent(),[2,t];case 2:return[4,m()];case 3:c=r.sent(),g=0,b=c,r.label=4;case 4:return g<b.length?[4,i("plugin:printer|get_jobs",{printername:(f=b[g]).name})]:[3,10];case 5:h=r.sent(),v=p(h),_=0,w=v,r.label=6;case 6:return _<w.length?(j=w[_],[4,i("plugin:printer|pause_job",{printername:f.name,jobid:j.Id.toString()})]):[3,9];case 7:r.sent(),r.label=8;case 8:return _++,[3,6];case 9:return g++,[3,4];case 10:return[2,t];case 11:return[2,{success:!1,message:(S=r.sent()).message?S.message:"Fail to pause job"}];case 12:return[2]}}))}))},w=function(e){return void 0===e&&(e=null),n(void 0,void 0,void 0,(function(){var t,n,o,a,s,u,l,c,g,b,f,h,v,_,w,j,S;return r(this,(function(r){switch(r.label){case 0:if(r.trys.push([0,11,,12]),t={success:!0,message:"OK"},null==e)return[3,2];if(n=d(e),o=n.split("_@_"),a=o[0],s=void 0===a?null:a,u=o[1],l=void 0===u?null:u,null==s||null==l)throw new Error("Wrong jobid");return[4,i("plugin:printer|remove_job",{printername:s,jobid:l.toString()})];case 1:return r.sent(),[2,t];case 2:return[4,m()];case 3:c=r.sent(),g=0,b=c,r.label=4;case 4:return g<b.length?[4,i("plugin:printer|get_jobs",{printername:(f=b[g]).name})]:[3,10];case 5:h=r.sent(),v=p(h),_=0,w=v,r.label=6;case 6:return _<w.length?(j=w[_],[4,i("plugin:printer|remove_job",{printername:f.name,jobid:j.Id.toString()})]):[3,9];case 7:r.sent(),r.label=8;case 8:return _++,[3,6];case 9:return g++,[3,4];case 10:return[2,t];case 11:return[2,{success:!1,message:(S=r.sent()).message?S.message:"Fail to pause job"}];case 12:return[2]}}))}))};export{f as getJob,b as getJobs,m as getPrinters,_ as pauseJob,g as printFile,w as removeJob,h as restartJob,v as resumeJob};
